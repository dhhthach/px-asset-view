<link rel="import" href="../polymer/polymer.html" />

<dom-module id="node-viewer">

  <style>
    .dialog {
      width: 20%;
      padding: 1rem;
      border: 1px solid gainsboro;
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      background-color: white;
    }

    #masker {
      position: absolute;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: rgba(255, 255, 255, 0.9);
    }

    .action {
      position: absolute;
      top: 0.2rem;
      right: 0.2rem;
    }
    .content div.attr-name {
      background-color: gainsboro;
      padding: 0.2rem;
      display: inline-block;
      margin: 0.2rem 0.2rem;
    }
  </style>
  <template>

    <div id="masker">
      <div class="dialog">
        <div class="header">
          <h3 id="node-name" contenteditable="true">{{nodeData.data.name}}</h3>
        </div>
        <div class="content">
          <div style="margin-bottom: 1rem"><b>Attributes </b><i on-click="_addAttribute" class="fa fa-plus"></i></div>
          <div>
            <template id="list" is="dom-repeat" items="{{_cloneAttributes}}">
              <div class="attr-name" contenteditable="true">{{item}}</div>
              <span><i index="{{index}}" class="fa fa-close" on-click="_removeAttribute"></i></span>
            </template>
          </div>
          <div class="action">
            <i class="fa fa-check" on-click="_saveChanges"></i>
            <i class="fa fa-close" on-click="_close"></i>
          </div>
        </div>
      </div>
    </div>

  </template>

</dom-module>

<script>

  Polymer({

    is: 'node-viewer',

    properties: {
      nodeData: {
        type: Object,
        value: function() {
          return {};
        }
      },
      _cloneAttributes: {
        type: Array,
        value: function() {
          return [];
        }
      }
    },

    _saveChanges: function(e) {
      this.nodeData.data.name = document.querySelector('#node-name').textContent;
      this.nodeData.data.attributes = [...document.querySelectorAll('div.attr-name')].map(function(e) {
        return e.textContent;
      });
      this.fire('save', {node: this.nodeData});
      this._close();
    },

    _close: function(e) {
      this.fire('close');
    },

    _addAttribute: function() {
      this.push('_cloneAttributes', 'New Attribute');
    },

    _removeAttribute: function(e) {
      debugger;
      this.splice('_cloneAttributes', e.target.index, 1);
    },

    attached: function() {
      var attributes = this.nodeData.data.attributes;
      this._cloneAttributes = attributes ? attributes.map((x) => (x)) : [];
    }

  });
</script>